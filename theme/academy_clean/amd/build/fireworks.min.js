define(["jquery"],function(a){function b(a){if(a.rockets.length<f){var b=new e(a);a.rockets.push(b)}}function c(c){var d=new Date;d.getTime()<c.starttime.getTime()+h?b(c):d.getTime()>c.starttime.getTime()+h+1e4&&(clearInterval(c.interval),a(c.canvas).fadeOut(1e3)),c.canvas.width!=window.innerWidth&&(c.canvas.width=window.innerWidth),c.canvas.height!=window.innerHeight&&(c.canvas.height=window.innerHeight),c.canvas_buffer.width!=window.innerWidth&&(c.canvas_buffer.width=window.innerWidth),c.canvas_buffer.height!=window.innerHeight&&(c.canvas_buffer.height=window.innerHeight),c.context_buffer.clearRect(0,0,c.canvas.width,c.canvas.height),c.context_buffer.globalAlpha=.9,c.context_buffer.drawImage(c.canvas,0,0),c.context.clearRect(0,0,c.canvas.width,c.canvas.height),c.context.drawImage(c.canvas_buffer,0,0);var e=[];c.rockets.forEach(function(a){a.update(),a.render(c.context);var b=a.pos.y<2*c.canvas.height/3?100*Math.random()<=1:!1;a.pos.y<c.canvas.height/5||a.vel.y>=0||b?a.explode(c):e.push(a)}),c.rockets=e;var f=[];for(c.particles.forEach(function(a){a.update(),a.exists()&&(a.render(c.context),f.push(a))}),c.particles=f;c.particles.length>g;)c.particles.shift()}function d(a){this.pos={x:a?a.x:0,y:a?a.y:0},this.vel={x:0,y:0},this.shrink=.97,this.size=2,this.resistance=1,this.gravity=0,this.flick=!1,this.alpha=1,this.fade=0,this.color=0}function e(a){d.apply(this,[{x:Math.random()*a.canvas.width*2/3+a.canvas.width/6,y:a.canvas.height}]),this.explosionColor=10*Math.floor(360*Math.random()/10),this.vel.y=-3*Math.random()-4,this.vel.x=6*Math.random()-3,this.size=2,this.shrink=.999,this.gravity=.01}var f=5,g=250,h=15e3,i={init:function(b){var d=a(b);if(void 0===d.data("fireworks_data")){var e=document.createElement("canvas"),f=document.createElement("canvas"),g={element:b,canvas:e,context:e.getContext("2d"),canvas_buffer:f,context_buffer:f.getContext("2d"),particles:[],rockets:[],starttime:new Date};"static"===d.css("position")&&(b.style.position="relative"),b.appendChild(e),e.style.position="fixed",e.style.top="0px",e.style.bottom="0px",e.style.left="0px",e.style.right="0px",e.style.pointerEvents="none",e.style.zIndex=101,g.interval=setInterval(c.bind(this,g),20),d.data("fireworks_data",g)}},destroy:function(b){var c=a(b);if(void 0!==c.data("fireworks_data")){var d=c.data("fireworks_data");c.removeData("fireworks_data"),clearInterval(d.interval),d.canvas.remove(),d.element.style.position=""}},start:function(){a("body").fireworks()}};return a.fn.fireworks=function(a){return a||(a="init"),this.each(function(){i[a](this)}),this},d.prototype.update=function(){this.vel.x*=this.resistance,this.vel.y*=this.resistance,this.vel.y+=this.gravity,this.pos.x+=this.vel.x,this.pos.y+=this.vel.y,this.size*=this.shrink,this.alpha-=this.fade},d.prototype.render=function(a){if(this.exists()){a.save(),a.globalCompositeOperation="lighter";var b=this.pos.x,c=this.pos.y,d=this.size/2,e=a.createRadialGradient(b,c,.1,b,c,d);e.addColorStop(.1,"rgba(255,255,255,"+this.alpha+")"),e.addColorStop(.8,"hsla("+this.color+", 100%, 50%, "+this.alpha+")"),e.addColorStop(1,"hsla("+this.color+", 100%, 50%, 0.1)"),a.fillStyle=e,a.beginPath(),a.arc(this.pos.x,this.pos.y,this.flick?Math.random()*this.size:this.size,0,2*Math.PI,!0),a.closePath(),a.fill(),a.restore()}},d.prototype.exists=function(){return this.alpha>=.1&&this.size>=1},e.prototype=new d,e.prototype.constructor=e,e.prototype.explode=function(a){for(var b=10*Math.random()+80,c=0;b>c;c++){var e=new d(this.pos),f=Math.random()*Math.PI*2,g=15*Math.cos(Math.random()*Math.PI/2);e.vel.x=Math.cos(f)*g,e.vel.y=Math.sin(f)*g,e.size=10,e.gravity=.2,e.resistance=.92,e.shrink=.05*Math.random()+.93,e.flick=!0,e.color=this.explosionColor,a.particles.push(e)}},e.prototype.render=function(a){if(this.exists()){a.save(),a.globalCompositeOperation="lighter";var b=this.pos.x,c=this.pos.y,d=this.size/2,e=a.createRadialGradient(b,c,.1,b,c,d);e.addColorStop(.1,"rgba(255, 255, 255 ,"+this.alpha+")"),e.addColorStop(.2,"rgba(255, 180, 0, "+this.alpha+")"),a.fillStyle=e,a.beginPath(),a.arc(this.pos.x,this.pos.y,this.flick?Math.random()*this.size/2+this.size/2:this.size,0,2*Math.PI,!0),a.closePath(),a.fill(),a.restore()}},i});